<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h4>Registro de usuarios</h4>
    <input id="email" type="email" placeholder="Ingresa email">
    <input id="password" type="password" placeholder="Ingrese contraseña">
    <button id="register">Enviar</button>

    <h4>Ingreso de usuarios</h4>
    <input id="email2" type="email" placeholder="Ingresa email">
    <input id="password2" type="password" placeholder="Ingrese contraseña">
    <button id="ingreso">Acceder</button>


          
     <script src="app.js"></script>
     <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth,
           createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
             onAuthStateChanged ,
             signOut,
             sendEmailVerification,    
            } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyB0aytR2kq9oV6_9DdeTLs2nGlQTzOxDAE",
          authDomain: "usuarios-b78e1.firebaseapp.com",
          projectId: "usuarios-b78e1",
          storageBucket: "usuarios-b78e1.appspot.com",
          messagingSenderId: "779291947290",
          appId: "1:779291947290:web:9bed27d795c7d614183ca3",
          measurementId: "${config.measurementId}"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        document.getElementById("register").addEventListener('click', function(){
              const email= document.getElementById("email").value
              const password= document.getElementById("password").value
        createUserWithEmailAndPassword(auth, email, password)
            .then((userCredential) => {
                  // Signed in 
                  verificar()
             const user = userCredential.user;
                  // ...
                  console.log("created")
               })
            .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
                 // ..
                 console.log(errorCode + errorMessage)
  });

        });

        document.getElementById("ingreso").addEventListener('click', function(){
                const email2=document.getElementById("email2").value
                const password2=document.getElementById("password2").value
                signInWithEmailAndPassword(auth, email2, password2)
                .then((userCredential) => {
               // Signed in 
                const user = userCredential.user;
               // ...
               })
               .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
                console.log(errorCode + errorMessage)
  });
        });
       
          onAuthStateChanged(auth, (user) => {
            
            if (user) {
            if (user.emailVerified){
             
            document.getElementById('ingreso').innerHTML=`<p>Logueado</p>  <button id ="close">Cerrar sesion</button>`
           
            console.log("activo")

            cerrar(user)
            }
           const uid = user.uid;
           console.log(user.emailVerified)
        } else {

          console.log("no")
          }
 
              });
            
              function cerrar(user){
              document.getElementById("close").addEventListener('click', function(){
                var user=user; 
                  signOut(auth)
                  .then(function(){
  
                    
                    console.log("salir");
  
                  })
                 // ...
                 
                 .catch(function(error){
                   console.log(error);
                 })
                
                }    

              )};
              function verificar(){
                sendEmailVerification(auth.currentUser)
                .then(() => {
                  // Email verification sent!
                     // ...
  });
              }
      </script>
      
</body>
</html>